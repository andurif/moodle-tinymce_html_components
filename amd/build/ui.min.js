define("tiny_html_components/ui",["exports","core/templates","core/url","./options","core/str","core/notification","tiny_html_components/modal","core/modal_events","core/modal_factory","tiny_html_components/components"],(function(_exports,_templates,_url,_options,_str,_notification,_modal,_modal_events,_modal_factory,_components){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny html_component modal display and event management.
   * @module      tiny_html_components/ui
   * @copyright   2023 Gerbault Cédric, Anthony Durif, Université Clermont Auvergne
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_templates=_interopRequireDefault(_templates),_url=_interopRequireDefault(_url),_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory);_exports.handleAction=editor=>{displayDialogue(editor)};const getTemplateContext=async editor=>{let selectList=[],promise=[],customGroup=!1,customComponent=[];_components.components.forEach((item=>{promise.push((0,_str.get_string)(item.name,"tiny_html_components"))})),void 0!==(0,_options.getCustomComponents)(editor)&&(customComponent=JSON.parse((0,_options.getCustomComponents)(editor)),customGroup=!0),await Promise.all(promise).then((values=>{values.forEach(((element,index)=>{let params={};params.id=_components.components[index].id,params.string=element,selectList.push(params)}))}));const customUrl=await _url.default.fileUrl("/lib/editor/tiny/plugins/html_components/custom_components.php","");return Object.assign({},{selectList:selectList},{customUrl:customUrl},{customComponent:customComponent},{customGroup:customGroup})},displayDialogue=async editor=>{const modal=await _modal_factory.default.create({type:_modal.default.TYPE,templateContext:await getTemplateContext(editor),large:!0});modal.show();const $root=modal.getRoot();$root[0].addEventListener("change",(event=>{handleModalChange(event,modal,editor)})),$root.on(_modal_events.default.save,((event,modal)=>{handleDialogueSubmission(editor,modal)}))},handleModalChange=async(event,modal)=>{const preview=modal.getRoot()[0].querySelector("#component_preview"),options=modal.getRoot()[0].querySelector("#options-placeholder");switch(event.target.dataset.holder){case"component-selector":{preview.innerHTML="";const selected=_components.components[event.target.value];if("custom"==event.target.value){var txt=document.createElement("textarea");txt.innerHTML=event.target.options[event.target.selectedIndex].dataset.content,preview.innerHTML=txt.value+"&nbsp"}else selected.params?await _templates.default.renderForPromise("tiny_html_components/components/".concat(selected.name),{}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents("#options-placeholder",html,js)})).catch((error=>(0,_notification.exception)(error))):options.innerHTML="",preview.innerHTML=selected.code()+"&nbsp";break}case"params":refreshPreview(preview);break;case"options":toggleTargetVisibility(event,"toggle"),refreshPreview(preview)}},handleDialogueSubmission=(editor,modal)=>{const contentToAdd=modal.getRoot()[0].querySelector("#component_preview");editor.insertContent(contentToAdd.innerHTML),editor.save(),modal.destroy()},refreshPreview=preview=>{preview.innerHTML="";let parentComp=_components.components[document.getElementById("component").value];preview.innerHTML=parentComp.code()+"&nbsp"},toggleTargetVisibility=event=>{const target=event.target.dataset.target;document.getElementById(target).classList.toggle("d-none")}}));

//# sourceMappingURL=ui.min.js.map